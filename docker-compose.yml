version: '3.8'

services:
  # --------------------
  # 1. FASTAPI BACKEND SERVICE
  # --------------------
  api:
    container_name: prototype_api
    # Uses the Dockerfile we defined above
    build:
      context: ./backend
      dockerfile: Dockerfile.dev
    # The command is defined in the Dockerfile.dev (uvicorn with --reload)
    # Map the internal container port (8000) to a host port (8000)
    ports:
      - "8000:8000"
    # This is the key for hot-reloading! It maps your local code into the container.
    volumes:
      - ./backend:/app
    environment:
      # Use the MongoDB service name for the connection string
      MONGO_HOST: db
      MONGO_PORT: 27017
      # Other sensitive or environment-specific variables go here (e.g., Firebase key)
    depends_on:
      - db

  # --------------------
  # 2. VUE.JS FRONTEND SERVICE
  # --------------------
  frontend:
    container_name: prototype_frontend
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    # Vue dev server's internal port (5173 for Vite) mapped to host (5173)
    ports:
      - "5173:5173"
    # Key for hot-reloading! Maps your local code into the container.
    volumes:
      - ./frontend:/app
      - /app/node_modules # Anonymous volume to prevent local node_modules overwriting container's

  # --------------------
  # 3. MONGODB DATABASE SERVICE
  # --------------------
  db:
    container_name: prototype_db
    image: mongo:latest
    # Map the internal port 27017 to the host port 27017 (Optional but useful for connecting a local GUI tool)
    ports:
      - "27017:27017"
    # Persist the data to your local 'data/mongo_data' folder
    volumes:
      - ./data/mongo_data:/data/db
    # Security/Setup variables
    environment:
      MONGO_INITDB_ROOT_USERNAME: ${MONGO_USERNAME}
      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_PASSWORD}